# sql.yaml - This file contains SQL statements used by Crackup.
---
archive_data:
  create: |
    CREATE TABLE IF NOT EXISTS archive_data (
      path     TEXT PRIMARY KEY,
      filedata BLOB
    );

archive_index:
  create: |
    CREATE TABLE IF NOT EXISTS archive_index (
      path       TEXT PRIMARY KEY,
      hash       TEXT,
      byte_start INTEGER,
      byte_end   INTEGER
    );

archive_meta:
  create: |
    CREATE TABLE IF NOT EXISTS archive_meta (
      creator_name    TEXT,
      creator_version TEXT,
      creator_url     TEXT
    );

chunks:
  create: |
    CREATE TABLE IF NOT EXISTS chunks (
      id   INTEGER PRIMARY KEY AUTOINCREMENT,
      size INTEGER DEFAULT 0
    );

dirs:
  create: |
    CREATE TABLE IF NOT EXISTS dirs (
      id        INTEGER PRIMARY KEY AUTOINCREMENT,
      parent_id INTEGER DEFAULT 0,
      path      TEXT UNIQUE,
      name      TEXT
    );

  has_dir?: |
    SELECT
      COUNT(*)
    FROM dirs
    WHERE
      path = :path;

files:
  create: |
    CREATE TABLE IF NOT EXISTS files (
      id        INTEGER PRIMARY KEY AUTOINCREMENT,
      dir_id    INTEGER,
      path      TEXT UNIQUE,
      name      TEXT,
      hash      TEXT,
      ctime     INTEGER DEFAULT 0,
      mtime     INTEGER DEFAULT 0,
      inode     INTEGER DEFAULT 0,
      size      INTEGER DEFAULT 0,
      timestamp INTEGER DEFAULT 0
    );
    
  has_file?: |
    SELECT
      COUNT(*)
    FROM files
    WHERE
      path = :path;

files_chunks_map:
  create: |
    CREATE TABLE IF NOT EXISTS files_chunks_map (
      file_id    INTEGER,
      chunk_id   INTEGER,
      byte_start INTEGER,
      byte_end   INTEGER
    );
